# انتخاب واحد هوشمند KPU - مستندات فنی پروژه

این مستند یک نمای کلی فنی و جامع از وب اپلیکیشن "انتخاب واحد هوشمند KPU" ارائه می‌دهد. هدف از این مستند، ارائه جزئیات کافی برای درک، بازسازی و توسعه پروژه توسط توسعه‌دهندگان یا سیستم‌های هوش مصنوعی است.

---

## ۱. معرفی پروژه

**انتخاب واحد هوشمند KPU** یک دستیار تحت وب پیشرفته برای دانشجویان دانشگاه فرهنگیان است که فرآیند پیچیده انتخاب واحد را ساده و بهینه می‌کند. این ابزار با استفاده از هوش مصنوعی، بهترین برنامه درسی ممکن را بر اساس قوانین دانشگاه و اولویت‌های شخصی دانشجو پیشنهاد می‌دهد.

---

## ۲. پشته فناوری (Tech Stack)

این پروژه با استفاده از جدیدترین ابزارها و کتابخانه‌های مدرن وب ساخته شده است:

- **فریمورک اصلی:** **Next.js 15** (با App Router)
- **زبان برنامه‌نویسی:** **TypeScript**
- **استایل‌دهی:** **Tailwind CSS**
- **کامپوننت‌های UI:** **shadcn/ui** (کتابخانه‌ای از کامپوننت‌های Reusable ساخته شده بر روی Radix UI و Tailwind CSS)
- **هوش مصنوعی:** **Genkit (Google AI SDK)** برای ارتباط با مدل‌های زبان بزرگ (LLMs) مانند **Gemini 2.5 Flash**.
- **مدیریت فرم‌ها:** **React Hook Form** برای مدیریت فرم‌ها و **Zod** برای اعتبارسنجی Schema-based.
- **مدیریت وضعیت (State Management):** **React Hooks** (شامل `useState`, `useEffect`, `useReducer`, `useMemo`, `useTransition`).
- **ذخیره‌سازی سمت کلاینت:** **`localStorage`** برای ذخیره کلید API، سانس‌های کلاسی و گروه‌های درسی.
- **آیکون‌ها:** **Lucide React**.
- **پردازش فایل:**
    - **PDF:** از مدل Gemini برای استخراج متن و داده‌های ساختاریافته استفاده می‌شود.
    - **CSV/Excel:** **PapaParse** برای فایل‌های CSV و **XLSX (SheetJS)** برای فایل‌های اکسل.
- **خروجی گرفتن از برنامه:**
    - **PNG:** **html-to-image**
    - **PDF:** **jspdf**
    - **CSV:** **PapaParse**

---

## ۳. ساختار پروژه

ساختار فایل‌ها و پوشه‌ها به شرح زیر است:

- **`/src/app/`**: قلب برنامه با استفاده از Next.js App Router.
    - **`page.tsx`**: صفحه اصلی که تمام کامپوننت‌ها را در کنار هم قرار می‌دهد.
    - **`layout.tsx`**: লেআউট اصلی برنامه شامل `<html>` و `<body>`.
    - **`globals.css`**: استایل‌های سراسری و متغیرهای تم CSS (استایل shadcn).
- **`/src/components/`**: کامپوننت‌های React برنامه.
    - **`ui/`**: کامپوننت‌های پایه shadcn/ui که در پروژه نصب شده‌اند (مانند Button, Card, Input).
    - **`course-scheduler.tsx`**: کامپوننت اصلی و والد که وضعیت کلی برنامه را مدیریت می‌کند.
    - **`schedule-display.tsx`**: کامپوننت مسئول نمایش گرافیکی برنامه هفتگی (هم حالت دستی و هم AI).
    - **`add-course-form.tsx`**: فرم افزودن دستی دروس.
    - **`edit-course-dialog.tsx`**: دیالوگ ویرایش دروس موجود.
    - **`student-preferences-form.tsx`**: فرم دریافت اولویت‌های دانشجو.
    - **`ai-assistant.tsx`**: کامپوننت چت‌بات دستیار هوشمند.
- **`/src/ai/`**: تمام منطق مربوط به هوش مصنوعی در این پوشه قرار دارد.
    - **`genkit.ts`**: فایل پیکربندی اصلی Genkit و تعریف مدل پیش‌فرض (Gemini 2.5 Flash).
    - **`flows/`**: شامل تمام جریان‌های (Flows) هوش مصنوعی است.
        - **`extract-courses-from-pdf.ts`**: جریان استخراج اطلاعات دروس از فایل PDF.
        - **`suggest-optimal-schedule.ts`**: جریان اصلی پیشنهاد برنامه بهینه.
        - **`menu-suggestion-flow.ts`**: جریان مربوط به چت‌بات دستیار هوشمند.
- **`/src/hooks/`**: هوک‌های سفارشی React.
    - **`use-toast.ts`**: برای نمایش اعلان‌ها (Toasts).
- **`/src/lib/`**: شامل توابع کمکی و داده‌های استاتیک.
    - **`utils.ts`**: تابع کمکی `cn` برای ترکیب کلاس‌های Tailwind CSS.
- **`/src/types/`**: تعریف اینترفیس‌ها و تایپ‌های TypeScript (مانند `Course`, `Instructor`).

---

## ۴. قابلیت‌های کلیدی (Features)

### ۴.۱. مدیریت دروس
- **افزودن درس:** کاربر می‌تواند دروس را به سه روش اضافه کند:
    1.  **دستی:** با پر کردن فرم شامل کد، نام، استاد، دسته‌بندی، گروه، روز و سانس کلاس.
    2.  **از طریق PDF:** با آپلود فایل PDF چارت درسی دانشگاه، هوش مصنوعی تمام دروس را استخراج می‌کند.
    3.  **از طریق Excel/CSV:** با آپلود فایل اکسل با ستون‌های مشخص.
- **ویرایش دروس:** امکان ویرایش تمام مشخصات یک درس پس از افزودن.
- **حذف دروس:** امکان حذف یک درس یا پاک کردن کل لیست دروس.
- **پشتیبان‌گیری و بازیابی:** امکان ذخیره لیست دروس در یک فایل JSON و بازیابی آن.

### ۴.۲. مدیریت سانس و گروه
- **سانس کلاسی:** کاربر می‌تواند بازه‌های زمانی (سانس) مشخصی را تعریف کند (مثلاً سانس اول: ۰۷:۳۰ تا ۰۹:۰۰) تا در فرم افزودن درس از آن‌ها استفاده کند.
- **گروه درسی:** کاربر می‌تواند گروه‌های درسی مختلفی (مثلاً گروه ۱، گروه ۲) را تعریف کرده و هر درس را به یک گروه اختصاص دهد.

### ۴.۳. برنامه‌ریزی هوشمند (AI-Powered)
- **جریان `suggestOptimalSchedule`:**
    - **ورودی‌ها:** لیست تمام دروس موجود، اولویت‌های دانشجو (روز تعطیل، ترجیح شیفت صبح/عصر، اولویت استاد برای دروس عمومی).
    - **منطق:**
        1.  AI تمام گروه‌های درسی را تحلیل می‌کند.
        2.  گروهی را انتخاب می‌کند که با اولویت‌های دانشجو (روز تعطیل و شیفت) بیشترین تطابق را دارد.
        3.  دروس عمومی را بر اساس اولویت استاد و عدم تداخل زمانی به برنامه اضافه می‌کند.
        4.  یک برنامه کامل، بهینه و بدون تداخل ایجاد می‌کند.
    - **خروجی:** یک آبجکت شامل برنامه پیشنهادی، گروه پیشنهادی، لیست تداخلات (در صورت وجود) و دلیل منطقی انتخاب (Rationale).

### ۴.۴. برنامه هفتگی (Schedule Display)
- **دو حالت نمایش:**
    1.  **برنامه پیشنهادی AI:** نمایش خروجی جریان هوشمند.
    2.  **برنامه دستی:** کاربر با تیک زدن دروس از لیست، برنامه خود را می‌سازد.
- **نمایش گرافیکی:**
    - چیدمان مدرن با محور افقی برای سانس‌ها و محور عمودی برای روزهای هفته.
    - رنگ‌بندی پویای دروس برای تفکیک بصری.
    - طراحی کاملاً واکنش‌گرا (Responsive) برای نمایش صحیح در دسکتاپ و موبایل.
- **تشخیص تداخل:** در حالت دستی، اگر دروس انتخاب‌شده تداخل زمانی داشته باشند، یک هشدار واضح در زیر جدول نمایش داده می‌شود.

### ۴.۵. دستیار هوشمند (AI Assistant)
- یک چت‌بات که کاربر می‌تواند سوالات خود را در مورد انتخاب واحد، برنامه‌ریزی درسی و حتی موضوعات دیگر مانند برنامه غذایی بپرسد.
- از تاریخچه گفتگو برای ارائه پاسخ‌های مرتبط‌تر استفاده می‌کند.

### ۴.۶. خروجی و اشتراک‌گذاری
- کاربر می‌تواند برنامه هفتگی نهایی را در سه فرمت دانلود کند:
    - **PNG:** فایل عکس باکیفیت.
    - **PDF:** فایل PDF آماده برای چاپ.
    - **CSV:** فایل داده برای استفاده در نرم‌افزارهای صفحه گسترده مانند Excel.

### ۴.۷. مدیریت کلید API
- کاربر می‌تواند کلید Gemini API خود را در بخش تنظیمات وارد و ذخیره کند. کلید در `localStorage` مرورگر ذخیره می‌شود تا نیازی به ورود مجدد در هر بار استفاده نباشد. یک کلید پیش‌فرض نیز برای تست اولیه در کد قرار داده شده است.

---

## ۵. جزئیات جریان‌های هوش مصنوعی (AI Flows)

### `extractCoursesFromPdf.ts`
- **هدف:** استخراج اطلاعات دروس از یک فایل PDF.
- **ورودی:** یک `pdfDataUri` (فایل PDF به صورت Base64).
- **منطق پرامپت:** به Gemini دستور داده می‌شود که PDF را تحلیل کرده و اطلاعات هر درس (کد، نام، استاد، دسته‌بندی، زمان، مکان، گروه) را بر اساس یک Schema از پیش تعریف شده (Zod Schema) استخراج کند.
- **خروجی:** آرایه‌ای از آبجکت‌های `Course`.

### `suggestOptimalSchedule.ts`
- **هدف:** پیشنهاد بهترین برنامه درسی ممکن.
- **ورودی:** لیست دروس موجود، اولویت‌های دانشجو.
- **منطق پرامپت:** پرامپت بسیار دقیقی که قوانین انتخاب واحد دانشگاه فرهنگیان (مانند برداشتن دروس تخصصی از یک گروه) و اولویت‌های دانشجو را به AI توضیح می‌دهد و از آن می‌خواهد تا گروه‌ها را تحلیل کرده و بهترین گزینه را انتخاب کند.
- **خروجی:** یک آبجکت شامل برنامه نهایی، گروه پیشنهادی، تداخلات و توضیح منطقی.

### `menuSuggestionFlow.ts`
- **هدف:** پاسخگویی به سوالات عمومی کاربر در چت‌بات.
- **ورودی:** تاریخچه گفتگو و سوال فعلی کاربر.
- **منطق پرامپت:** یک پرامپت کلی که شخصیت دستیار را تعریف کرده و از او می‌خواهد به سوالات دانشجو در زمینه انتخاب واحد و موضوعات مرتبط پاسخ دهد.
- **خروجی:** یک رشته (string) حاوی پاسخ AI.
